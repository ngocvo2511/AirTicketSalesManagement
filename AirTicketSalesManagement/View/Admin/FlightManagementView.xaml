<UserControl x:Class="AirTicketSalesManagement.View.Admin.FlightManagementView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:AirTicketSalesManagement.View.Admin"
                          xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:Icon="http://metro.mahapps.com/winfx/xaml/iconpacks"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <TextBlock Grid.Row="0" Text="QUẢN LÝ CHUYẾN BAY" 
                   FontSize="24" FontWeight="Bold" 
                   Foreground="#6366F1" Margin="0,0,0,20"/>

        <!-- Search Section -->
        <Border Grid.Row="1" Background="#F8FAFC" CornerRadius="8" Padding="20" Margin="0,0,0,20">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Search Fields Row 1 -->
                <StackPanel Grid.Column="0" Margin="0,0,10,0">
                    <TextBlock Text="Số hiệu chuyến bay" FontWeight="Medium" Margin="0,0,0,5"/>
                    <TextBox x:Name="txtSearchFlightNumber" 
                             Text="{Binding SearchFlightNumber, UpdateSourceTrigger=PropertyChanged}"
                             materialDesign:HintAssist.Hint="Nhập số hiệu..."
                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                             Height="40"/>
                </StackPanel>

                <StackPanel Grid.Column="1" Margin="10,0,10,0">
                    <TextBlock Text="Sân bay đi" FontWeight="Medium" Margin="0,0,0,5"/>
                    <ComboBox x:Name="cboSearchDeparture"
                              ItemsSource="{Binding Airports}"
                              SelectedValue="{Binding SearchDepartureAirport}"
                              DisplayMemberPath="TenSB"
                              SelectedValuePath="MaSB"
                              materialDesign:HintAssist.Hint="Chọn sân bay đi"
                              Style="{StaticResource MaterialDesignOutlinedComboBox}"
                              Height="40"/>
                </StackPanel>

                <StackPanel Grid.Column="2" Margin="10,0,10,0">
                    <TextBlock Text="Sân bay đến" FontWeight="Medium" Margin="0,0,0,5"/>
                    <ComboBox x:Name="cboSearchDestination"
                              ItemsSource="{Binding Airports}"
                              SelectedValue="{Binding SearchDestinationAirport}"
                              DisplayMemberPath="TenSB"
                              SelectedValuePath="MaSB"
                              materialDesign:HintAssist.Hint="Chọn sân bay đến"
                              Style="{StaticResource MaterialDesignOutlinedComboBox}"
                              Height="40"/>
                </StackPanel>

                <!-- Search Row 2 -->
                <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,10,10,0">
                    <TextBlock Text="Hãng hàng không" FontWeight="Medium" Margin="0,0,0,5"/>
                    <TextBox x:Name="txtSearchAirline"
                             Text="{Binding SearchAirline, UpdateSourceTrigger=PropertyChanged}"
                             materialDesign:HintAssist.Hint="Nhập tên hãng..."
                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                             Height="40"/>
                </StackPanel>

                <StackPanel Grid.Row="1" Grid.Column="1" Margin="10,10,10,0">
                    <TextBlock Text="Trạng thái khai thác" FontWeight="Medium" Margin="0,0,0,5"/>
                    <ComboBox x:Name="cboSearchStatus"
                              SelectedValue="{Binding SearchStatus}"
                              materialDesign:HintAssist.Hint="Chọn trạng thái"
                              Style="{StaticResource MaterialDesignOutlinedComboBox}"
                              Height="40">
                        <ComboBoxItem Content="Tất cả" Tag=""/>
                        <ComboBoxItem Content="Đang khai thác" Tag="Đang khai thác"/>
                        <ComboBoxItem Content="Tạm dừng" Tag="Tạm dừng"/>
                        <ComboBoxItem Content="Ngừng khai thác" Tag="Ngừng khai thác"/>
                    </ComboBox>
                </StackPanel>

                <!-- Search Buttons -->
                <StackPanel Grid.Row="1" Grid.Column="3" Orientation="Horizontal" 
                           VerticalAlignment="Bottom" Margin="10,10,0,0">
                    <Button x:Name="btnSearch" 
                            Command="{Binding SearchCommand}"
                            Style="{StaticResource MaterialDesignRaisedButton}"
                            Background="#6366F1"
                            Margin="0,0,10,0" Width="100" Height="40">
                        <Button.Content>
                            <StackPanel Orientation="Horizontal">
                                <Icon:PackIconMaterial Kind="Magnify" Width="16" Height="16" Margin="0,0,5,0"/>
                                <TextBlock Text="Tìm kiếm"/>
                            </StackPanel>
                        </Button.Content>
                    </Button>
                    <Button x:Name="btnClearSearch"
                            Command="{Binding ClearSearchCommand}"
                            Style="{StaticResource MaterialDesignOutlinedButton}"
                            Width="80" Height="40">
                        <Button.Content>
                            <StackPanel Orientation="Horizontal">
                                <Icon:PackIconMaterial Kind="FilterRemove" Width="16" Height="16" Margin="0,0,5,0"/>
                                <TextBlock Text="Xóa"/>
                            </StackPanel>
                        </Button.Content>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Flight List -->
        <Border Grid.Row="2" Background="White" CornerRadius="8" 
                BorderBrush="#E5E7EB" BorderThickness="1">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- List Header -->
                <Border Grid.Row="0" Background="#F8FAFC" CornerRadius="8,8,0,0" Padding="15,10">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="DANH SÁCH CHUYẾN BAY" FontWeight="Bold" FontSize="16"/>
                        <TextBlock Grid.Column="1" HorizontalAlignment="Right" 
                                   Text="{Binding FlightCount, StringFormat='Tổng: {0} chuyến bay'}"
                                   FontWeight="Medium" Foreground="#6B7280"/>
                    </Grid>
                </Border>

                <!-- ListView -->
                <ListView Grid.Row="1" x:Name="lvFlights"
                          ItemsSource="{Binding Flights}"
                          SelectedItem="{Binding SelectedFlight}"
                          Background="Transparent"
                          BorderThickness="0"
                          ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                    <ListView.View>
                        <GridView>
                            <GridViewColumn Header="Số hiệu CB" Width="120">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding SoHieuCB}" FontWeight="Bold" 
                                                   Foreground="#1D4ED8"/>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>

                            <GridViewColumn Header="Sân bay đi" Width="150">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel>
                                            <TextBlock Text="{Binding SBDiName}" FontWeight="Medium"/>
                                            <TextBlock Text="{Binding SBDi}" FontSize="11" 
                                                       Foreground="#6B7280"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>

                            <GridViewColumn Header="Sân bay đến" Width="150">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel>
                                            <TextBlock Text="{Binding SBDenName}" FontWeight="Medium"/>
                                            <TextBlock Text="{Binding SBDen}" FontSize="11" 
                                                       Foreground="#6B7280"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>

                            <GridViewColumn Header="Hãng hàng không" Width="140">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding HangHangKhong}" TextWrapping="Wrap"/>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>

                            <GridViewColumn Header="Thời gian bay" Width="100">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding SoGioBay, StringFormat={}{0:F1}h}"
                                        HorizontalAlignment="Center"/>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>

                            <GridViewColumn Header="Trạng thái" Width="120">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <Border CornerRadius="12" Padding="8,4" HorizontalAlignment="Center">
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding TTKhaiThac}" Value="Đang khai thác">
                                                            <Setter Property="Background" Value="#DCFCE7"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding TTKhaiThac}" Value="Tạm dừng">
                                                            <Setter Property="Background" Value="#FEF3C7"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding TTKhaiThac}" Value="Ngừng khai thác">
                                                            <Setter Property="Background" Value="#FEE2E2"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <TextBlock Text="{Binding TTKhaiThac}" FontSize="11" FontWeight="Medium">
                                                <TextBlock.Style>
                                                    <Style TargetType="TextBlock">
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding TTKhaiThac}" Value="Đang khai thác">
                                                                <Setter Property="Foreground" Value="#16A34A"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding TTKhaiThac}" Value="Tạm dừng">
                                                                <Setter Property="Foreground" Value="#D97706"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding TTKhaiThac}" Value="Ngừng khai thác">
                                                                <Setter Property="Foreground" Value="#DC2626"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </TextBlock.Style>
                                            </TextBlock>
                                        </Border>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>

                            <GridViewColumn Header="Thao tác" Width="120">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                            <Button Style="{StaticResource MaterialDesignIconButton}"
                                                    ToolTip="Sửa chuyến bay"
                                                    Command="{Binding DataContext.EditFlightCommand, 
                                                             RelativeSource={RelativeSource AncestorType=ListView}}"
                                                    CommandParameter="{Binding}"
                                                    Width="30" Height="30" Margin="2">
                                                <Icon:PackIconMaterial Kind="Pencil" Width="16" Height="16" 
                                                                       Foreground="#3B82F6"/>
                                            </Button>
                                            <Button Style="{StaticResource MaterialDesignIconButton}"
                                                    ToolTip="Xóa chuyến bay"
                                                    Command="{Binding DataContext.DeleteFlightCommand, 
                                                             RelativeSource={RelativeSource AncestorType=ListView}}"
                                                    CommandParameter="{Binding}"
                                                    Width="30" Height="30" Margin="2">
                                                <Icon:PackIconMaterial Kind="Delete" Width="16" Height="16" 
                                                                       Foreground="#EF4444"/>
                                            </Button>
                                        </StackPanel>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                        </GridView>
                    </ListView.View>

                    <!-- Empty State -->
                    <ListView.Style>
                        <Style TargetType="ListView">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Flights.Count}" Value="0">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate>
                                                <Border Background="White" CornerRadius="8">
                                                    <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" 
                                                               Margin="50">
                                                        <Icon:PackIconMaterial Kind="AirplaneTakeoff" 
                                                                               Width="64" Height="64" 
                                                                               Foreground="#D1D5DB" Margin="0,0,0,20"/>
                                                        <TextBlock Text="Không tìm thấy chuyến bay nào" 
                                                                   FontSize="18" FontWeight="Medium" 
                                                                   Foreground="#6B7280" HorizontalAlignment="Center"/>
                                                        <TextBlock Text="Thử thay đổi bộ lọc tìm kiếm hoặc thêm chuyến bay mới" 
                                                                   FontSize="14" Foreground="#9CA3AF" 
                                                                   HorizontalAlignment="Center" Margin="0,5,0,0"/>
                                                    </StackPanel>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </ListView.Style>
                </ListView>
            </Grid>
        </Border>

        <!-- Action Buttons -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Right" 
                    Margin="0,20,0,0">
            <Button x:Name="btnAddFlight"
                    Command="{Binding AddFlightCommand}"
                    Style="{StaticResource MaterialDesignRaisedButton}"
                    Background="#10B981"
                    Width="150" Height="45" Margin="0,0,10,0">
                <Button.Content>
                    <StackPanel Orientation="Horizontal">
                        <Icon:PackIconMaterial Kind="Plus" Width="18" Height="18" Margin="0,0,8,0"/>
                        <TextBlock Text="Thêm mới"/>
                    </StackPanel>
                </Button.Content>
            </Button>

            <Button x:Name="btnRefresh"
                    Command="{Binding RefreshCommand}"
                    Style="{StaticResource MaterialDesignOutlinedButton}"
                    Width="100" Height="45">
                <Button.Content>
                    <StackPanel Orientation="Horizontal">
                        <Icon:PackIconMaterial Kind="Refresh" Width="18" Height="18" Margin="0,0,8,0"/>
                        <TextBlock Text="Làm mới"/>
                    </StackPanel>
                </Button.Content>
            </Button>
        </StackPanel>
    </Grid>
</UserControl>
